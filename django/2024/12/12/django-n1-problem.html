<!DOCTYPE html>
<html>
    <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DJango에서 N + 1 Problem 해결하는 방법</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Serif+KR:wght@200..900&display=swap">
    <link rel="stylesheet" href="https://spsarolkar.github.io/rouge-theme-preview/css/syntax-gruvbox.dark.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Nanum+Gothic+Coding:wght@400;700&display=swap">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Nanum+Myeongjo:wght@400;700;800&display=swap">

    <link rel="stylesheet" href="https://recoma96.github.io/assets/css/main.css">
    <link rel="stylesheet" href="https://recoma96.github.io/assets/css/mathjax.css">

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>
    <body>
        <nav class="
        fixed layout-navbar
        w-full h-16 z-navbar
        text-light-primary-600 dark:text-dark-primary-default
        bg-light-primary-400 dark:bg-zinc-800 bg-opacity-80 backdrop-blur-[2px]
        dark:border-b dark:border-yellow-100
        shadow-navbar-light dark:shadow-navbar-darkq
">
    <div class="
        w-full
        flex justify-between items-center
    ">
        <i id="navbar-menu-button" class="nav-icon bi bi-list text-4xl xl:invisible"></i>

        <a id="navbar-title" href="/posts" class="
            text-lg hidden xl:block cursor-pointer no-underline font-bold text-white dark:text-dark-primary-200
        ">
            Recoma In DEV
        </a>

        <i id="navbar-mode-selector" class="nav-icon bi text-2xl"></i>
    </div>
</nav>

<ul id="navbar-menu" class="
    hidden fixed
    z-30 w-full mt-16 py-6
    bg-white dark:bg-zinc-950
    list-none
    flex flex-col gap-6 text-center
    shadow-navbar-menu
">
    <li class="border-buttom text-[1.2em]"><a class="no-underline text-current" href="/posts">Posts</a></li>
    <li class="border-buttom text-[1.2em]"><a class="no-underline text-current" href="/categories">Categories</a></li>
    <li class="border-buttom text-[1.2em]"><a class="no-underline text-current" href="/about"">About</a></li>
</ul>

        <div class="web-main-container">
            <div id="left-side-bar" class="
    hidden xl:block
    w-[300px] py-[100px] px-6
    bg-white dark:bg-zinc-900
    shadow-layout
">
    <div class="w-full text-center">
        <img src="/assets/img/profile.jpg" width="140px" height="140px"
            class="mx-auto rounded-full" alt="profile"
        />
        <h2 class="font-bold text-rose-400 dark:text-yellow-200">recoma</h2>
        <p>인생 재밌게 사는 방법 탐구중</p>
    </div>

    <div class="w-full mt-10 flex flex-wrap justify-center gap-8">
        
<a href="https://github.com/recoma96" class="social-icon text-inherit"><i class="bi bi-github social-icon-color" alt="github"></i></a>



<a href="mailto:seokbong60@gmail.com" class="social-icon text-inherit"><i class="bi bi-envelope-fill social-icon-color" alt="email"></i></a>










    </div>

    <div class="w-full h-[0px] border-b border-zinc-400 mt-8"></div>

    <div class="mt-8 w-full text-center flex flex-col gap-6">
        <a class="text-pink-600 dark:text-dark-text-default font-bold cursor-pointer no-underline" href="/posts">Posts</a>
        <a class="text-lime-600 dark:text-dark-text-default font-bold cursor-pointer no-underline" href="/categories">Categories</a>
        <a class="text-violet-600 dark:text-dark-text-default font-bold cursor-pointer no-underline" href="/about">About</a>
    </div>
</div>
<div class="w-[1px] bg-gray"></div>
            <div class="web-main-item">
                <div class="mb-20">
    <div class="text-center">
        <h2 class="
            px-10 py-4 inline-block
            bg-orange-100 text-orange-600 dark:text-yellow-200
            dark:bg-transparent dark:border-double dark:border dark:border-yellow-200 rounded-md
            shadow-paper-styled
        ">
            DJango에서 N + 1 Problem 해결하는 방법
        </h2>
        <p class="font-semibold"><a href="/categories/#Django" class="no-underline text-orange-700 dark:text-blue-200">Django</a></p>
    </div>
    
    <div class="mt-10">
        <p class="text-[0.8em]">Posted <strong class="no-underline">2024.12.12 01:00</strong></p>
        <p class="text-[0.8em] -mt-2">By <strong class="no-underline">recoma</strong></p>
    </div>

    <div class="
        mt-6 h-[2px] bg-gradient-to-r
        from-white via-lime-400 to-white
        dark:from-zinc-900 dark:via-yellow-200 dark:to-zinc-900
    "></div>

    
</div>
                <h1 id="개요">개요</h1>

<p>백엔드 프레임워크 또는 다른 라이브러리에서 제공하는 ORM 라이브러리는 데이터베이스와의 상호작용을 편하게 해준다.
하지만 이걸 아무생각없이 남용을 하게되면 DB트래픽 낭비를 하게 되는 이슈가 발생하게 되는데 대표적인 예가 <strong>N + 1 Problem</strong> 이다. Spring Boot, NodeJS등 많은 백엔드 프레임워크에 사용되는 ORM 라이브러리들이 N + 1 Problem을 해결하기 위해 여러가지 도구들을 제공하는 데, DJango-ORM 역시 이와 같은 도구들을 제공한다.</p>

<h2 id="n--1이-뭐에요">N + 1이 뭐에요?</h2>

<p><strong>N + 1 Problem</strong> 이란, 두 개의 연결된 테이블을 조회할 때, 하위 테이블을 참조해서 조회하기 위해 상위 테이블에서
조회된 N개의 테이블들을 하나씩 순회하면서 추가로 DB에 요청을 하는 것을 의미한다. 즉, 상위 테이블을 <strong>1번</strong> 조회하고, 조회된 데이터들을 순회하면서 <strong>하위 테이블들을 각각 조회하게 된다.</strong> 결국 DB에 <strong>N + 1</strong> 개의 요청을 하게 된다고 보면 된다. 이렇게 N이 기하급수적으로 커지게 되면 DB 부하가 커지게 됨은 물론, 서버 성능에도 영향을 미치게 된다.</p>

<h2 id="원인">원인</h2>

<p>Django를 포함한 여러 ORM 라이브러리들은 <strong>Lazy Loading</strong>을 지원한다.
Lazy Loading이란, ORM 함수를 사용한다고 해서 바로 사용하지는 않고 실제 DB 데이터를 사용하려는 시점에서 SQL문이 실행되는 것을 의미한다. 대표적으로 <code class="language-plaintext highlighter-rouge">get()</code>과 <code class="language-plaintext highlighter-rouge">first()</code>가 있다. 평소에는 가만히 있다가 이 함수들이 실행되면 바로 DB로 SQL문 실행을 한다. 그렇기 때문에 유동적으로 쿼리에 쿼리를 추가할 수가 있어 코드를 재활용할 수 있다는 장점이 있다. 하지만, 이는 곧 하위 테이블 데이터의 정보가 필요할 때마다 SQL문을 날리는 N + 1 Problem에 직면하게 된다.</p>

<h3 id="example">Example</h3>

<p>예를 들어 어떤 사용자가 작성한 짧은 게시물들을 조회한다고 할때, 아래와 같이 코드를 작성할 것이다.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="n">diaries</span> <span class="o">=</span> <span class="n">ShortDiary</span><span class="p">.</span><span class="n">objects</span><span class="p">.</span><span class="nf">filter</span><span class="p">(</span><span class="n">user</span><span class="o">=</span><span class="n">user</span><span class="p">).</span><span class="nf">all</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nf">print</span><span class="p">(</span><span class="n">diaries</span><span class="p">)</span>
<span class="p">(</span><span class="mf">0.001</span><span class="p">)</span> <span class="n">SELECT</span> <span class="sb">`short_diary`</span><span class="p">.</span><span class="sb">`id`</span><span class="p">,</span> <span class="sb">`short_diary`</span><span class="p">.</span><span class="sb">`user_id`</span><span class="p">,</span> <span class="sb">`short_diary`</span><span class="p">.</span><span class="sb">`title`</span><span class="p">,</span> <span class="sb">`short_diary`</span><span class="p">.</span><span class="sb">`context`</span><span class="p">,</span> <span class="sb">`short_diary`</span><span class="p">.</span><span class="sb">`is_deleted`</span> <span class="n">FROM</span> <span class="sb">`short_diary`</span> <span class="n">WHERE</span> <span class="sb">`short_diary`</span><span class="p">.</span><span class="sb">`user_id`</span> <span class="o">=</span> <span class="mi">16</span> <span class="n">LIMIT</span> <span class="mi">21</span><span class="p">;</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,);</span> <span class="n">alias</span><span class="o">=</span><span class="n">default</span>
<span class="o">&lt;</span><span class="n">QuerySet</span> <span class="p">[</span><span class="o">&lt;</span><span class="n">ShortDiary</span><span class="p">:</span> <span class="n">ShortDiary</span> <span class="nf">object </span><span class="p">(</span><span class="mi">41</span><span class="p">)</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">ShortDiary</span><span class="p">:</span> <span class="n">ShortDiary</span> <span class="nf">object </span><span class="p">(</span><span class="mi">42</span><span class="p">)</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">ShortDiary</span><span class="p">:</span> <span class="n">ShortDiary</span> <span class="nf">object </span><span class="p">(</span><span class="mi">43</span><span class="p">)</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">ShortDiary</span><span class="p">:</span> <span class="n">ShortDiary</span> <span class="nf">object </span><span class="p">(</span><span class="mi">44</span><span class="p">)</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">ShortDiary</span><span class="p">:</span> <span class="n">ShortDiary</span> <span class="nf">object </span><span class="p">(</span><span class="mi">45</span><span class="p">)</span><span class="o">&gt;</span><span class="p">]</span><span class="o">&gt;</span>
</code></pre></div></div>

<p>위에서 보다시피 <code class="language-plaintext highlighter-rouge">diaries = ShortDiary.objects.filter(user=user).all()</code>를 호출했지만, SQL을 실행한 흔적이 없다, 바로 밑의 <code class="language-plaintext highlighter-rouge">print()</code>를 호출해야 비로소 데이터베이스에 요청이 들어간 것이다. ShortDiary에 있는 데이터를 출력해야 하기 때문이다. 이렇게 꼭 필요한 상황이 되서야 DB에 갔다오기 때문에 <strong>Lazy Loading(게으른 로딩)</strong>이라고 부른다.</p>

<p><br /></p>

<p>하지만 이러한 Lazy Loading 방식은 곧 아래와 같은 문제를 유발하게 된다.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="n">diaries</span> <span class="o">=</span> <span class="n">ShortDiary</span><span class="p">.</span><span class="n">objects</span><span class="p">.</span><span class="nf">all</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">for</span> <span class="n">diary</span> <span class="ow">in</span> <span class="n">diaries</span><span class="p">:</span>
<span class="p">...</span>     <span class="nf">print</span><span class="p">(</span><span class="n">diary</span><span class="p">.</span><span class="n">user</span><span class="p">)</span>
<span class="p">...</span> 

<span class="p">(</span><span class="mf">0.001</span><span class="p">)</span> <span class="n">SELECT</span> <span class="sb">`short_diary`</span><span class="p">.</span><span class="sb">`id`</span><span class="p">,</span> <span class="sb">`short_diary`</span><span class="p">.</span><span class="sb">`user_id`</span><span class="p">,</span> <span class="sb">`short_diary`</span><span class="p">.</span><span class="sb">`title`</span><span class="p">,</span> <span class="sb">`short_diary`</span><span class="p">.</span><span class="sb">`context`</span><span class="p">,</span> <span class="sb">`short_diary`</span><span class="p">.</span><span class="sb">`is_deleted`</span> <span class="n">FROM</span> <span class="sb">`short_diary`</span><span class="p">;</span> <span class="n">args</span><span class="o">=</span><span class="p">();</span> <span class="n">alias</span><span class="o">=</span><span class="n">default</span>
<span class="p">(</span><span class="mf">0.000</span><span class="p">)</span> <span class="n">SELECT</span> <span class="sb">`user`</span><span class="p">.</span><span class="sb">`id`</span><span class="p">,</span> <span class="sb">`user`</span><span class="p">.</span><span class="sb">`password`</span><span class="p">,</span> <span class="sb">`user`</span><span class="p">.</span><span class="sb">`last_login`</span><span class="p">,</span> <span class="sb">`user`</span><span class="p">.</span><span class="sb">`is_superuser`</span><span class="p">,</span> <span class="sb">`user`</span><span class="p">.</span><span class="sb">`email`</span><span class="p">,</span> <span class="sb">`user`</span><span class="p">.</span><span class="sb">`nickname`</span><span class="p">,</span> <span class="sb">`user`</span><span class="p">.</span><span class="sb">`gender`</span><span class="p">,</span> <span class="sb">`user`</span><span class="p">.</span><span class="sb">`is_active`</span> <span class="n">FROM</span> <span class="sb">`user`</span> <span class="n">WHERE</span> <span class="sb">`user`</span><span class="p">.</span><span class="sb">`id`</span> <span class="o">=</span> <span class="mi">20</span> <span class="n">LIMIT</span> <span class="mi">21</span><span class="p">;</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,);</span> <span class="n">alias</span><span class="o">=</span><span class="n">default</span>
<span class="n">mccarthydouglas</span><span class="nd">@example.net</span> <span class="o">-</span> <span class="n">debbiecarr</span>
<span class="p">(</span><span class="mf">0.000</span><span class="p">)</span> <span class="n">SELECT</span> <span class="sb">`user`</span><span class="p">.</span><span class="sb">`id`</span><span class="p">,</span> <span class="sb">`user`</span><span class="p">.</span><span class="sb">`password`</span><span class="p">,</span> <span class="sb">`user`</span><span class="p">.</span><span class="sb">`last_login`</span><span class="p">,</span> <span class="sb">`user`</span><span class="p">.</span><span class="sb">`is_superuser`</span><span class="p">,</span> <span class="sb">`user`</span><span class="p">.</span><span class="sb">`email`</span><span class="p">,</span> <span class="sb">`user`</span><span class="p">.</span><span class="sb">`nickname`</span><span class="p">,</span> <span class="sb">`user`</span><span class="p">.</span><span class="sb">`gender`</span><span class="p">,</span> <span class="sb">`user`</span><span class="p">.</span><span class="sb">`is_active`</span> <span class="n">FROM</span> <span class="sb">`user`</span> <span class="n">WHERE</span> <span class="sb">`user`</span><span class="p">.</span><span class="sb">`id`</span> <span class="o">=</span> <span class="mi">20</span> <span class="n">LIMIT</span> <span class="mi">21</span><span class="p">;</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,);</span> <span class="n">alias</span><span class="o">=</span><span class="n">default</span>
<span class="n">mccarthydouglas</span><span class="nd">@example.net</span> <span class="o">-</span> <span class="n">debbiecarr</span>
<span class="p">(</span><span class="mf">0.000</span><span class="p">)</span> <span class="n">SELECT</span> <span class="sb">`user`</span><span class="p">.</span><span class="sb">`id`</span><span class="p">,</span> <span class="sb">`user`</span><span class="p">.</span><span class="sb">`password`</span><span class="p">,</span> <span class="sb">`user`</span><span class="p">.</span><span class="sb">`last_login`</span><span class="p">,</span> <span class="sb">`user`</span><span class="p">.</span><span class="sb">`is_superuser`</span><span class="p">,</span> <span class="sb">`user`</span><span class="p">.</span><span class="sb">`email`</span><span class="p">,</span> <span class="sb">`user`</span><span class="p">.</span><span class="sb">`nickname`</span><span class="p">,</span> <span class="sb">`user`</span><span class="p">.</span><span class="sb">`gender`</span><span class="p">,</span> <span class="sb">`user`</span><span class="p">.</span><span class="sb">`is_active`</span> <span class="n">FROM</span> <span class="sb">`user`</span> <span class="n">WHERE</span> <span class="sb">`user`</span><span class="p">.</span><span class="sb">`id`</span> <span class="o">=</span> <span class="mi">20</span> <span class="n">LIMIT</span> <span class="mi">21</span><span class="p">;</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,);</span> <span class="n">alias</span><span class="o">=</span><span class="n">default</span>
<span class="n">mccarthydouglas</span><span class="nd">@example.net</span> <span class="o">-</span> <span class="n">debbiecarr</span>
<span class="p">(</span><span class="mf">0.000</span><span class="p">)</span> <span class="n">SELECT</span> <span class="sb">`user`</span><span class="p">.</span><span class="sb">`id`</span><span class="p">,</span> <span class="sb">`user`</span><span class="p">.</span><span class="sb">`password`</span><span class="p">,</span> <span class="sb">`user`</span><span class="p">.</span><span class="sb">`last_login`</span><span class="p">,</span> <span class="sb">`user`</span><span class="p">.</span><span class="sb">`is_superuser`</span><span class="p">,</span> <span class="sb">`user`</span><span class="p">.</span><span class="sb">`email`</span><span class="p">,</span> <span class="sb">`user`</span><span class="p">.</span><span class="sb">`nickname`</span><span class="p">,</span> <span class="sb">`user`</span><span class="p">.</span><span class="sb">`gender`</span><span class="p">,</span> <span class="sb">`user`</span><span class="p">.</span><span class="sb">`is_active`</span> <span class="n">FROM</span> <span class="sb">`user`</span> <span class="n">WHERE</span> <span class="sb">`user`</span><span class="p">.</span><span class="sb">`id`</span> <span class="o">=</span> <span class="mi">20</span> <span class="n">LIMIT</span> <span class="mi">21</span><span class="p">;</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,);</span> <span class="n">alias</span><span class="o">=</span><span class="n">default</span>
</code></pre></div></div>

<p>ShortDiary(일기장)를 조회하고. 각각의 일기장을 누가 썼는지 출력 하는 코드다. RAW Query라면 JOIN문 한번에 가져올 수 있지만 여기는 ORM이다. Lazy Loading 방식이기 때문에 일기장 주인(User)을 출력하기 전 까지 아무것도 안하다가. 출력하는 순간(<code class="language-plaintext highlighter-rouge">print(diary.user)</code>)이 되서야 SQL문을 날린다. 이걸 일기 갯수(diaries)대로 반복을 하게 되고 결국 N + 1 Problem이 발생하게 된다. 결국 DB에 불필요한 요청을 보내는 꼴이 되고, 이는 서버와 DB 둘다 불필요한 트래픽으로 인해 성능저하가 발생하게 된다.</p>

<p><br /></p>

<p>하지만 ORM은 이러한 이슈가 계속 발생이 되도록 방관하지 않는다. 빠져나갈 방법은 있다.</p>

<h1 id="해결-방법">해결 방법</h1>

<p>사실 해결 방법은 간단하다. JOIN을 사용하면 된다. 이렇게 되면 쿼리문 1번으로 끝내는 것이 가능하다. 하지만 여기는 RAW Query가 아닌 ORM이기 때문에 다른 방법을 사용해야 한다. Django에서는 <strong>select_related</strong>와 <strong>prefetch_related</strong>를 지원한다. <code class="language-plaintext highlighter-rouge">select_related</code>는 JOIN문 1번으로 모든 데이터르들을 한꺼번에 불러오고, <code class="language-plaintext highlighter-rouge">prefetch_related</code>는 상위 테이블 한번, 그 상위 테이블에서 조회된 고유키를 가지고 하위 테이블 조회 함으로써 총 2번 요청을 한다. 이렇게 Lazy Loading이 아닌, 미리미리 데이터를 불러와서 활용하는 방식을 <strong>Eager Loading</strong> 이라고 한다.</p>

<h2 id="모델-구조">모델 구조</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">models</span><span class="p">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">db_table</span> <span class="o">=</span> <span class="sh">"</span><span class="s">user</span><span class="sh">"</span>

    <span class="n">GENDER_CODE</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">(</span><span class="sh">"</span><span class="s">M</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Male</span><span class="sh">"</span><span class="p">),</span>
        <span class="p">(</span><span class="sh">"</span><span class="s">F</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Female</span><span class="sh">"</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="n">email</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="nc">EmailField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="sh">"</span><span class="s">이메일</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">nickname</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="nc">CharField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="sh">"</span><span class="s">닉네임</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">gender</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="nc">CharField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">choices</span><span class="o">=</span><span class="n">GENDER_CODE</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="sh">"</span><span class="s">성별</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">is_active</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="nc">BooleanField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="sh">"</span><span class="s">활성화 여부</span><span class="sh">"</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">ShortDiary</span><span class="p">(</span><span class="n">models</span><span class="p">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">db_table</span> <span class="o">=</span> <span class="sh">"</span><span class="s">short_diary</span><span class="sh">"</span>

    <span class="n">user</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="nc">ForeignKey</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="sh">"</span><span class="s">short_diaries</span><span class="sh">"</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="p">.</span><span class="n">CASCADE</span><span class="p">)</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="nc">CharField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">256</span><span class="p">)</span>
    <span class="n">context</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="nc">CharField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">1024</span><span class="p">)</span>
    <span class="n">is_deleted</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="nc">BooleanField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="select_related">select_related</h2>

<p>정참조 또는 1대1에서 주로 사용되는 함수다.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="n">diaries</span> <span class="o">=</span> <span class="n">ShortDiary</span><span class="p">.</span><span class="n">objects</span><span class="p">.</span><span class="nf">select_related</span><span class="p">(</span><span class="sh">"</span><span class="s">user</span><span class="sh">"</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">for</span> <span class="n">diary</span> <span class="ow">in</span> <span class="n">diaries</span><span class="p">:</span>
<span class="p">...</span>     <span class="nf">print</span><span class="p">(</span><span class="n">diary</span><span class="p">.</span><span class="n">user</span><span class="p">)</span>
<span class="p">...</span> 

<span class="p">(</span><span class="mf">0.001</span><span class="p">)</span> <span class="n">SELECT</span> <span class="sb">`short_diary`</span><span class="p">.</span><span class="sb">`id`</span><span class="p">,</span> <span class="sb">`short_diary`</span><span class="p">.</span><span class="sb">`user_id`</span><span class="p">,</span> <span class="sb">`short_diary`</span><span class="p">.</span><span class="sb">`title`</span><span class="p">,</span> <span class="sb">`short_diary`</span><span class="p">.</span><span class="sb">`context`</span><span class="p">,</span> <span class="sb">`short_diary`</span><span class="p">.</span><span class="sb">`is_deleted`</span><span class="p">,</span> <span class="sb">`user`</span><span class="p">.</span><span class="sb">`id`</span><span class="p">,</span> <span class="sb">`user`</span><span class="p">.</span><span class="sb">`password`</span><span class="p">,</span> <span class="sb">`user`</span><span class="p">.</span><span class="sb">`last_login`</span><span class="p">,</span> <span class="sb">`user`</span><span class="p">.</span><span class="sb">`is_superuser`</span><span class="p">,</span> <span class="sb">`user`</span><span class="p">.</span><span class="sb">`email`</span><span class="p">,</span> <span class="sb">`user`</span><span class="p">.</span><span class="sb">`nickname`</span><span class="p">,</span> <span class="sb">`user`</span><span class="p">.</span><span class="sb">`gender`</span><span class="p">,</span> <span class="sb">`user`</span><span class="p">.</span><span class="sb">`is_active`</span> <span class="n">FROM</span> <span class="sb">`short_diary`</span> <span class="n">INNER</span> <span class="n">JOIN</span> <span class="sb">`user`</span> <span class="nc">ON </span><span class="p">(</span><span class="sb">`short_diary`</span><span class="p">.</span><span class="sb">`user_id`</span> <span class="o">=</span> <span class="sb">`user`</span><span class="p">.</span><span class="sb">`id`</span><span class="p">);</span> <span class="n">args</span><span class="o">=</span><span class="p">();</span> <span class="n">alias</span><span class="o">=</span><span class="n">default</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">select_related</code>는 <code class="language-plaintext highlighter-rouge">JOIN</code>을 이용해서 문제를 해결한다. 위의 예시에서는 일기를 작성한 사용자(User)의 정보를 가져오는 코드이다. 사용된 쿼리문은 <code class="language-plaintext highlighter-rouge">JOIN</code>문 딱 하나다.</p>

<h3 id="작동이-안되는-경우">작동이 안되는 경우</h3>

<p>반대로 사용자가 어떤 일기를 썼는지 조회하는 경우도 있을 수 있다. 즉 1대다 상황이 되는데, 이때 <code class="language-plaintext highlighter-rouge">select_related</code>를 사용하게 되면 아래와 같은 에러가 발생하게 된다.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="n">users</span> <span class="o">=</span> <span class="n">User</span><span class="p">.</span><span class="n">objects</span><span class="p">.</span><span class="nf">select_related</span><span class="p">(</span><span class="sh">'</span><span class="s">short_diaries</span><span class="sh">'</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">users</span><span class="p">:</span>
<span class="p">...</span>     <span class="nf">print</span><span class="p">(</span><span class="n">user</span><span class="p">.</span><span class="n">__dict__</span><span class="p">)</span>

<span class="n">django</span><span class="p">.</span><span class="n">core</span><span class="p">.</span><span class="n">exceptions</span><span class="p">.</span><span class="n">FieldError</span><span class="p">:</span> <span class="n">Invalid</span> <span class="n">field</span> <span class="nf">name</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="n">given</span> <span class="ow">in</span> <span class="n">select_related</span><span class="p">:</span> <span class="sh">'</span><span class="s">short_diaries</span><span class="sh">'</span><span class="p">.</span> <span class="n">Choices</span> <span class="n">are</span><span class="p">:</span> <span class="p">(</span><span class="n">none</span><span class="p">)</span>
</code></pre></div></div>

<p>short_diaries라는 이름의 field name이 없다는 문구가 뜬다. User Model에 선언된 멤버변수 들 중 short_diaries라는 이름의 변수는 없기 때문이다. 이 경우, prefetch_related를 사용해야 한다.</p>

<h2 id="prefetch_related">prefetch_related</h2>

<p>상위 테이블 조회 1번, 하위 테이블 조회 1번, 총 2번 요청을 한다.
1대다, 다대다나 역참조에서 주로 사용된다.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="n">users</span> <span class="o">=</span> <span class="n">User</span><span class="p">.</span><span class="n">objects</span><span class="p">.</span><span class="nf">prefetch_related</span><span class="p">(</span><span class="sh">"</span><span class="s">short_diaries</span><span class="sh">"</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">users</span><span class="p">:</span>
<span class="p">...</span>     <span class="nf">print</span><span class="p">(</span><span class="n">user</span><span class="p">.</span><span class="n">short_diaries</span><span class="p">)</span>
<span class="p">...</span> 
<span class="p">(</span><span class="mf">0.001</span><span class="p">)</span> <span class="n">SELECT</span> <span class="sb">`user`</span><span class="p">.</span><span class="sb">`id`</span><span class="p">,</span> <span class="sb">`user`</span><span class="p">.</span><span class="sb">`password`</span><span class="p">,</span> <span class="sb">`user`</span><span class="p">.</span><span class="sb">`last_login`</span><span class="p">,</span> <span class="sb">`user`</span><span class="p">.</span><span class="sb">`is_superuser`</span><span class="p">,</span> <span class="sb">`user`</span><span class="p">.</span><span class="sb">`email`</span><span class="p">,</span> <span class="sb">`user`</span><span class="p">.</span><span class="sb">`nickname`</span><span class="p">,</span> <span class="sb">`user`</span><span class="p">.</span><span class="sb">`gender`</span><span class="p">,</span> <span class="sb">`user`</span><span class="p">.</span><span class="sb">`is_active`</span> <span class="n">FROM</span> <span class="sb">`user`</span><span class="p">;</span> <span class="n">args</span><span class="o">=</span><span class="p">();</span> <span class="n">alias</span><span class="o">=</span><span class="n">default</span>
<span class="p">(</span><span class="mf">0.000</span><span class="p">)</span> <span class="n">SELECT</span> <span class="sb">`short_diary`</span><span class="p">.</span><span class="sb">`id`</span><span class="p">,</span> <span class="sb">`short_diary`</span><span class="p">.</span><span class="sb">`user_id`</span><span class="p">,</span> <span class="sb">`short_diary`</span><span class="p">.</span><span class="sb">`title`</span><span class="p">,</span> <span class="sb">`short_diary`</span><span class="p">.</span><span class="sb">`context`</span><span class="p">,</span> <span class="sb">`short_diary`</span><span class="p">.</span><span class="sb">`is_deleted`</span> <span class="n">FROM</span> <span class="sb">`short_diary`</span> <span class="n">WHERE</span> <span class="sb">`short_diary`</span><span class="p">.</span><span class="sb">`user_id`</span> <span class="nc">IN </span><span class="p">(</span><span class="mi">24</span><span class="p">,</span> <span class="mi">25</span><span class="p">);</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="mi">24</span><span class="p">,</span> <span class="mi">25</span><span class="p">);</span> <span class="n">alias</span><span class="o">=</span><span class="n">default</span>
</code></pre></div></div>
<p><code class="language-plaintext highlighter-rouge">select_related</code>에서는 되지 않았던 역참조가 <code class="language-plaintext highlighter-rouge">prefetch_related</code> 에서는 정상작동이 되었다.</p>

<h1 id="사용시-주의해야-할-점">사용시 주의해야 할 점</h1>

<h2 id="prefetch_related-와-함께-하위-테이블에-대한-정렬을-하려는-경우">prefetch_related 와 함께 하위 테이블에 대한 정렬을 하려는 경우</h2>

<p>간혹 하위 테이블을 기준으로 정렬을 하려는 경우가 있다. 그런데 위에서 언급했다시피 prefetch_related는 역참조 또는 1..n대다에서 사용되는 함수다. 즉, 하위 테이블의 데이터가 여러개 존재할 수 있다는 얘기가 된다. 결국, 하위 테이블의 모든 데이터들을 참조할 수 밖에 없고, 그 결과 <strong>하위 테이블의 갯수대로 상위 테이블 데이터가 중복이 된다.</strong> 따라서 prefetch_related를 사용할 경우, 하위 테이블을 기준으로 정렬하는 것을 권장하지 않고, 어쩔 수 없이 사용하게 된다면, 쿼리 결과를 그대로 사용하는게 아니라 별도의 로직을 통해 데이터를 가공해야 할 필요가 있다.</p>

<h3 id="예시">예시</h3>

<ul>
  <li>각 User에는 5개의 ShortDiary가 있음</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">users</span> <span class="o">=</span> <span class="n">User</span><span class="p">.</span><span class="n">objects</span><span class="p">.</span><span class="nf">prefetch_related</span><span class="p">(</span><span class="sh">"</span><span class="s">short_diaries</span><span class="sh">"</span><span class="p">).</span><span class="nf">all</span><span class="p">()</span>
<span class="n">prefetched_users</span> <span class="o">=</span> <span class="n">User</span><span class="p">.</span><span class="n">objects</span><span class="p">.</span><span class="nf">prefetch_related</span><span class="p">(</span><span class="sh">"</span><span class="s">short_diaries</span><span class="sh">"</span><span class="p">).</span><span class="nf">order_by</span><span class="p">(</span><span class="sh">"</span><span class="s">short_diaries__id</span><span class="sh">"</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Users: </span><span class="si">{</span><span class="nf">len</span><span class="p">(</span><span class="n">users</span><span class="p">)</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Prefetched Users: </span><span class="si">{</span><span class="nf">len</span><span class="p">(</span><span class="n">prefetched_users</span><span class="p">)</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>

<span class="c1"># 결과
</span><span class="n">Users</span><span class="p">:</span> <span class="mi">2</span>
<span class="n">Prefetched</span> <span class="n">Users</span><span class="p">:</span> <span class="mi">10</span> <span class="c1"># 2 x 5 = 10
</span></code></pre></div></div>

<h3 id="first-get-사용">first(), get() 사용</h3>

<p>참조된 하위 테이블 중 가장 위에 있는 데이터를 사용하기 위해 <code class="language-plaintext highlighter-rouge">first()</code> 또는 <code class="language-plaintext highlighter-rouge">get()</code>을 사용을 하는 경우가 생기는데, 이 두개의 함수를 사용하게 되면 Eager Loading을 했음에도 불구하고 다시 N + 1 Problem 이 발생하는 사고가 생긴다.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">users</span> <span class="o">=</span> <span class="n">User</span><span class="p">.</span><span class="n">objects</span><span class="p">.</span><span class="nf">prefetch_related</span><span class="p">(</span><span class="sh">"</span><span class="s">short_diaries</span><span class="sh">"</span><span class="p">)</span>
<span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">users</span><span class="p">:</span>
    <span class="n">diary</span> <span class="o">=</span> <span class="n">user</span><span class="p">.</span><span class="n">short_diaries</span><span class="p">.</span><span class="nf">first</span><span class="p">()</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">diary</span><span class="p">.</span><span class="n">title</span><span class="p">)</span>

<span class="p">(</span><span class="mf">0.000</span><span class="p">)</span> <span class="n">SELECT</span> <span class="sb">`user`</span><span class="p">.</span><span class="sb">`id`</span><span class="p">,</span> <span class="sb">`user`</span><span class="p">.</span><span class="sb">`password`</span><span class="p">,</span> <span class="sb">`user`</span><span class="p">.</span><span class="sb">`last_login`</span><span class="p">,</span> <span class="sb">`user`</span><span class="p">.</span><span class="sb">`is_superuser`</span><span class="p">,</span> <span class="sb">`user`</span><span class="p">.</span><span class="sb">`email`</span><span class="p">,</span> <span class="sb">`user`</span><span class="p">.</span><span class="sb">`nickname`</span><span class="p">,</span> <span class="sb">`user`</span><span class="p">.</span><span class="sb">`gender`</span><span class="p">,</span> <span class="sb">`user`</span><span class="p">.</span><span class="sb">`is_active`</span> <span class="n">FROM</span> <span class="sb">`user`</span><span class="p">;</span> <span class="n">args</span><span class="o">=</span><span class="p">();</span> <span class="n">alias</span><span class="o">=</span><span class="n">default</span>
<span class="p">(</span><span class="mf">0.000</span><span class="p">)</span> <span class="n">SELECT</span> <span class="sb">`short_diary`</span><span class="p">.</span><span class="sb">`id`</span><span class="p">,</span> <span class="sb">`short_diary`</span><span class="p">.</span><span class="sb">`user_id`</span><span class="p">,</span> <span class="sb">`short_diary`</span><span class="p">.</span><span class="sb">`title`</span><span class="p">,</span> <span class="sb">`short_diary`</span><span class="p">.</span><span class="sb">`context`</span><span class="p">,</span> <span class="sb">`short_diary`</span><span class="p">.</span><span class="sb">`is_deleted`</span> <span class="n">FROM</span> <span class="sb">`short_diary`</span> <span class="n">WHERE</span> <span class="sb">`short_diary`</span><span class="p">.</span><span class="sb">`user_id`</span> <span class="nc">IN </span><span class="p">(</span><span class="mi">26</span><span class="p">,</span> <span class="mi">27</span><span class="p">);</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="mi">26</span><span class="p">,</span> <span class="mi">27</span><span class="p">);</span> <span class="n">alias</span><span class="o">=</span><span class="n">default</span>

<span class="c1"># User 갯수대로 추가 SQL문 요청 
</span><span class="p">(</span><span class="mf">0.000</span><span class="p">)</span> <span class="n">SELECT</span> <span class="sb">`short_diary`</span><span class="p">.</span><span class="sb">`id`</span><span class="p">,</span> <span class="sb">`short_diary`</span><span class="p">.</span><span class="sb">`user_id`</span><span class="p">,</span> <span class="sb">`short_diary`</span><span class="p">.</span><span class="sb">`title`</span><span class="p">,</span> <span class="sb">`short_diary`</span><span class="p">.</span><span class="sb">`context`</span><span class="p">,</span> <span class="sb">`short_diary`</span><span class="p">.</span><span class="sb">`is_deleted`</span> <span class="n">FROM</span> <span class="sb">`short_diary`</span> <span class="n">WHERE</span> <span class="sb">`short_diary`</span><span class="p">.</span><span class="sb">`user_id`</span> <span class="o">=</span> <span class="mi">26</span> <span class="n">ORDER</span> <span class="n">BY</span> <span class="sb">`short_diary`</span><span class="p">.</span><span class="sb">`id`</span> <span class="n">ASC</span> <span class="n">LIMIT</span> <span class="mi">1</span><span class="p">;</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="mi">26</span><span class="p">,);</span> <span class="n">alias</span><span class="o">=</span><span class="n">default</span>
<span class="n">radio</span>
<span class="p">(</span><span class="mf">0.000</span><span class="p">)</span> <span class="n">SELECT</span> <span class="sb">`short_diary`</span><span class="p">.</span><span class="sb">`id`</span><span class="p">,</span> <span class="sb">`short_diary`</span><span class="p">.</span><span class="sb">`user_id`</span><span class="p">,</span> <span class="sb">`short_diary`</span><span class="p">.</span><span class="sb">`title`</span><span class="p">,</span> <span class="sb">`short_diary`</span><span class="p">.</span><span class="sb">`context`</span><span class="p">,</span> <span class="sb">`short_diary`</span><span class="p">.</span><span class="sb">`is_deleted`</span> <span class="n">FROM</span> <span class="sb">`short_diary`</span> <span class="n">WHERE</span> <span class="sb">`short_diary`</span><span class="p">.</span><span class="sb">`user_id`</span> <span class="o">=</span> <span class="mi">27</span> <span class="n">ORDER</span> <span class="n">BY</span> <span class="sb">`short_diary`</span><span class="p">.</span><span class="sb">`id`</span> <span class="n">ASC</span> <span class="n">LIMIT</span> <span class="mi">1</span><span class="p">;</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="mi">27</span><span class="p">,);</span> <span class="n">alias</span><span class="o">=</span><span class="n">default</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">diary = user.short_diaries.first()</code>에서 short_diary 테이블을 한번 더 조회하고 있다. 즉, 유저 갯수 마다 short_diary를 한번 씩 데이터베이스에 직접 조회하고 있다는 것이다. 그렇기 때문에 <code class="language-plaintext highlighter-rouge">first()</code> 대신 <code class="language-plaintext highlighter-rouge">all()[0]</code> 을 사용해야 한다.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">users</span> <span class="o">=</span> <span class="n">User</span><span class="p">.</span><span class="n">objects</span><span class="p">.</span><span class="nf">prefetch_related</span><span class="p">(</span><span class="sh">"</span><span class="s">short_diaries</span><span class="sh">"</span><span class="p">)</span>
<span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">users</span><span class="p">:</span>
    <span class="n">diary</span> <span class="o">=</span> <span class="n">user</span><span class="p">.</span><span class="n">short_diaries</span><span class="p">.</span><span class="nf">all</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">diary</span><span class="p">.</span><span class="n">title</span><span class="p">)</span>

<span class="p">(</span><span class="mf">0.000</span><span class="p">)</span> <span class="n">SELECT</span> <span class="sb">`user`</span><span class="p">.</span><span class="sb">`id`</span><span class="p">,</span> <span class="sb">`user`</span><span class="p">.</span><span class="sb">`password`</span><span class="p">,</span> <span class="sb">`user`</span><span class="p">.</span><span class="sb">`last_login`</span><span class="p">,</span> <span class="sb">`user`</span><span class="p">.</span><span class="sb">`is_superuser`</span><span class="p">,</span> <span class="sb">`user`</span><span class="p">.</span><span class="sb">`email`</span><span class="p">,</span> <span class="sb">`user`</span><span class="p">.</span><span class="sb">`nickname`</span><span class="p">,</span> <span class="sb">`user`</span><span class="p">.</span><span class="sb">`gender`</span><span class="p">,</span> <span class="sb">`user`</span><span class="p">.</span><span class="sb">`is_active`</span> <span class="n">FROM</span> <span class="sb">`user`</span><span class="p">;</span> <span class="n">args</span><span class="o">=</span><span class="p">();</span> <span class="n">alias</span><span class="o">=</span><span class="n">default</span>
<span class="p">(</span><span class="mf">0.000</span><span class="p">)</span> <span class="n">SELECT</span> <span class="sb">`short_diary`</span><span class="p">.</span><span class="sb">`id`</span><span class="p">,</span> <span class="sb">`short_diary`</span><span class="p">.</span><span class="sb">`user_id`</span><span class="p">,</span> <span class="sb">`short_diary`</span><span class="p">.</span><span class="sb">`title`</span><span class="p">,</span> <span class="sb">`short_diary`</span><span class="p">.</span><span class="sb">`context`</span><span class="p">,</span> <span class="sb">`short_diary`</span><span class="p">.</span><span class="sb">`is_deleted`</span> <span class="n">FROM</span> <span class="sb">`short_diary`</span> <span class="n">WHERE</span> <span class="sb">`short_diary`</span><span class="p">.</span><span class="sb">`user_id`</span> <span class="nc">IN </span><span class="p">(</span><span class="mi">26</span><span class="p">,</span> <span class="mi">27</span><span class="p">);</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="mi">26</span><span class="p">,</span> <span class="mi">27</span><span class="p">);</span> <span class="n">alias</span><span class="o">=</span><span class="n">default</span>
<span class="n">radio</span>
<span class="n">man</span>
</code></pre></div></div>


                <div class="
                    mt-6 h-[2px] bg-gradient-to-r
                    from-white via-cyan-400 to-white
                    dark:from-zinc-900 dark:via-yellow-200 dark:to-zinc-900
                "></div>
                <div class="px-4 py-4 flex flex-wrap justify-start gap-x-2.5 gap-y-1.5">
                    
                    <a class="tag" href="/tags/#django">django</a>
                    
                    <a class="tag" href="/tags/#database">database</a>
                    
                </div>

                <script src="https://utteranc.es/client.js"
                    repo="recoma96/recoma96.github.io"
                    issue-term="url"
                    label="blog"
                    theme="github-light"
                    crossorigin="anonymous"
                    async>
                </script>
            </div>
        </div>

        <div class="
    absolute xl:px-[140px] px-mobileX
    w-full bottom-0 flex flex-col pb-10
    text-ornage-800 text-sm text-white font-footer
    bg-lime-600 dark:bg-zinc-900 bg-opacity-80
    dark:border-t shadow-footer-light
    z-footer
">
    <div class="w-full flex flex-wrap justify-center gap-6 mt-6 xl:hidden">
        
<a href="https://github.com/recoma96" class="social-icon text-inherit"><i class="bi bi-github social-icon-color" alt="github"></i></a>



<a href="mailto:seokbong60@gmail.com" class="social-icon text-inherit"><i class="bi bi-envelope-fill social-icon-color" alt="email"></i></a>










    </div>
    <div class="leading-relaxed justify-between mt-6 flex">
        <div>
            <p>Designed by <a href="https://github.com/recoma96" class="no-underline text-blue-800 dark:text-yellow-200">recoma96</a></p>
            <p>Theme by <a href="https://github.com/recoma96/lollineon" class="no-underline text-blue-800 dark:text-yellow-200">LolliNeon</a></p>
        </div>
        <p>Powered by <a href="https://jekyllrb.com/docs/themes" class="no-underline text-blue-800 dark:text-yellow-200">jekyll</a></p>
    </div>
</div>
        <script type="text/javascript" src="https://code.jquery.com/jquery-latest.min.js"></script>
<script type="text/javascript" src="https://recoma96.github.io/assets/js/util.js"></script>
<script type="text/javascript" src="https://recoma96.github.io/assets/js/layout.js"></script>
<script type="text/javascript" src="https://recoma96.github.io/assets/js/navbar.js"></script>
    </body>
</html>